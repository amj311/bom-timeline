<!DOCTYPE html>
<html>

<head>
    <title>Immerse Study</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css" type="text/css" />
</head>

<body>
    <div id="app" :class="{ mobile: isMobile, focusOne: addingItem || editingItem }">

        <div id="main-view">

            <div id="person-summary">
                <div class="profile-img" style="background-image: url(./images/nephi.png)"></div>
                <h3>Book of Mormon Timeline</h3>
            </div>

            <div id="timeline-wrapper">
                
                
                <div id="mainPanel">
                        
                    <div id="timeline-box" class="fs-inner-wrapper" onwheel="app.handleTimelineScroll(event)">
    

                        <div id="markers" :style="{overflow: 'hidden', width: `${numEras * eraDuration * yearUnit}px`}">
                            <div id="scrollmarker" :style="{left: `${zoomTargetPos}px`}"></div>

                            <div id="flatLine" :style="{bottom: `${dividerHeight}rem`}"></div>
                            <div v-for="era in eras" class="century-block" :id="era" :style="{width: `${yearUnit * eraDuration}px`}">
                                <div class="era-label">
                                    <span v-if="era < 0">{{-era}} BC</span>
                                    <span v-else>{{era}} AD</span>
                                </div>
                            </div>
                        </div>
    
    
                        <div id="gallery">
    
                            <div v-for="arc in timelineEls.arcs" class="arc-group item-wrapper" :class="{hardFocus: arc.hasFocus}" :style="{color: arc.color}">
    
                                <svg :style="{position: 'absolute', left: arc.left, bottom: arc.base}" :height="arc.top-arc.base" :width="arc.right-arc.left">
                                    <line v-for="i in arc.points.length" v-if="arc.points[i]"
                                        :x1="arc.points[i-1].relX - arc.left" :y1="arc.points[i-1].relY - arc.base"
                                        :x2="arc.points[i].relX - arc.left" :y2="arc.points[i].relY - arc.base"
                                        :style="{stroke: arc.color, strokeWidth: 3}" />
                                </svg>
    
    
                                <div class="content">
                                    <div class="card" :style="{left: `${arc.left}px`, bottom: `calc(${Math.max(arc.base, 0)}px - 0em)`}">
                                        <div class="info">
                                            <div class="title">{{arc.name}}</div>
                                            <div class="details">
                                                <div class="date">{{arc.dateStr}}</div>
                                                <div class="place">{{arc.loc}}</div>
                                                <div class="note" v-if="arc.note" v-html="arc.note"></div>
                                            </div>
                                        </div>
    
                                        <div v-if="arc.recId" class="openRecord" @click="setTheaterRecord(arc.recId)"></div>
                                        <div v-if="isAdmin" class="editButton" @click="openEditForm(arc)"></div>
                                    </div>
                                </div>
    
                            </div>
    
    
                            <div v-for="event in timelineEls.events" :id="event.idString" class="item-wrapper eventPos" :class="{anchor: event.eventType == 'anchor', hasImg: event.img, ext: event.group === 'ext', hardFocus: event.hasFocus}" :style="{color: event.arc ? event.arc.color : '#bbb', left: `${event.relX}px`, bottom: `${event.relY}px`}">
                                <div class="content">
    
                                    <div class="line" :style="{height: event.relY+'px'}">
                                        <div class="date-tag">{{event.dateStr}}</div>
                                    </div>
    
                                    <div class="card-wrapper" @mouseenter="pauseZoom()" @mouseleave="allowZoom()">
                                        <div class="card">
                                            <div v-if="event.img" class="image">
                                                <img :src="event.img" :alt="event.name">
                                                <div class="openTheater" @click="setTheaterImageByObj(event)"></div>
                                            </div>
    
                                            <div class="info">
                                                <div class="title">{{event.name}}</div>
                                                <div class="details">
                                                    <div class="date">{{event.dateStr}}</div>
                                                    <div class="place">{{event.loc}}</div>
                                                    <div class="note" v-if="event.note" v-html="event.note"></div>
                                                </div>
                                            </div>
    
                                            <div v-if="event.recId" class="openRecord" @click="setTheaterRecord(event.recId)"></div>
                                            <div v-if="isAdmin" class="editButton" @click="openEditForm(event)"></div>
                                        </div>
    
                                        <div class="pointer-wrapper">
                                            <div class="pointer"></div>
                                        </div>
                                    </div>
    
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

                <div id="quizOverlay" v-show="showQuiz">


                    <div id="slides_area">
                        <div class="deck_slider">

                            <div v-for="card in quizCards" @click="reverseCard(card)" class="qcard" :class="{reversed: show_Qback, active: card.id === activeQIdx, left: card.id < activeQIdx, right: card.id > activeQIdx}">
                                <div class="qcard-height">
                                    <div class="qcard-content">

                                        <div v-if="!show_Qback">
                                            <div v-if="card.img" class="card-image-wrapper">
                                                <img :src="card.img" />
                                            </div>
                                            <div v-else>
                                                <h3>{{card.name}}</h3>
                                            </div>
                                        </div>
                                        <div v-if="show_Qback">
                                            <h3 class="title">{{card.name}}</h3>
                                            <div class="details">
                                                <div class="date">{{card.dateStr}}</div>
                                                <div class="place">{{card.loc}}</div>
                                                
                                                <br><br>
                                                <div class="note" v-if="card.note" v-html="card.note" style="white-space: pre-wrap;"></div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>


                        </div>


                        <div id="controls">
                            <button @click="activeQIdx = Math.max(0, activeQIdx - 1)">ðŸ‘ˆ</button>
                            <input v-model="displayQIdx" type="number" min="1" :max="quizCards.length" step="1" style="text-align: center;">
                            <button @click="activeQIdx = Math.min(quizCards.length - 1, activeQIdx + 1)">ðŸ‘‰</button>
                        </div>
                        
                        
                        <div id="leaveQuizBox">
                            <div id="leaveQuiz" @click="showQuiz = false" class="btn btn-secondary">Leave Quiz</div>
                        </div>

                    </div>

                </div>


                <div id="controls">
                    <div id="zoomBox">
                        <div id="zoomIn" @click="handleButtonZoomIn()" class="btn zoom"></div>
                        <div id="resetZoom" v-if="yearUnit > minYearUnit" @click="resetZoom()" class="btn zoom"></div>
                        <div id="zoomOut" @click="handleButtonZoomOut()" class="btn zoom"></div>
                    </div>
                    <div id="addEventBox">
                        <div v-if="isAdmin">
                            <div id="addEvent" @click="openAddForm('event')" class="btn">+ Add Event</div>
                            <div id="addArc" @click="openAddForm('arc')" class="btn">+ Add Arc</div>
                            <div id="logout" @click="logoutAdmin" class="btn">Logout</div>
                        </div>
                        <div v-else>
                            <div id="login" @click="loginAdmin" class="btn">Login</div>
                        </div>
                        
                        <div id="startQuiz" @click="showQuiz = true" class="btn btn-primary" style="color: #fff !important">Quiz Me!</div>
                    
                    </div>
                </div>

                <div id="right_panel" :class="{open: addingItem || editingItem}">
                    <div class="content-wrapper">

                        <form @submit.prevent="handleSubmitForm()">

                            <h2 v-if="editingItem">Editing {{tempItem.type}}</h2>
                            <h2 v-if="addingItem">Adding {{tempItem.type}}</h2>

                            <p>
                                <label for="name">Name</label><br>
                                <input id="name" v-model="tempItem.name">
                            </p>


                            <div v-if="tempItem.type == 'event'">
                                <div>
                                    Type of Event:
                                    <select v-model="tempItem.eventType">
                                        <option value="normal">Normal</option>
                                        <option value="anchor">Anchor</option>
                                    </select>
                                </div>

                                <p v-if="tempItem.eventType == 'normal'">
                                    <label for="loc">Location</label><br>
                                    <input id="loc" list="locList" v-model="tempItem.loc">
                                    <datalist id="locList">
                                        <option v-for="option in getOptionsFor(timelineEls.events, 'loc')"
                                            :value="option"></option>
                                    </datalist>
                                </p>

                                <p v-if="tempItem.eventType == 'normal'">
                                    <label for="img">Image URL</label><br>
                                    <input id="img" v-model="tempItem.img">
                                </p>
                                <p v-if="tempItem.img">
                                    <label for="tag">Image Tag</label><br>
                                    <input id="tag" v-model="tempItem.elId">
                                </p>
                                <p v-if="tempItem.eventType == 'normal'">
                                    <label for="recId">Link to Record</label><br>
                                    <input id="recId" list="recIdList" v-model="tempItem.recId">
                                    <datalist id="recIdList">
                                        <option v-for="option in getOptionsFor(records, 'elId')" :value="option">
                                        </option>
                                    </datalist>
                                </p>
                                <p>
                                    <label for="year">Year</label><br>
                                    <input id="year" v-model="tempItem.year" @change="handleChangeAddYear"
                                        type="number">
                                    <div style="display:flex">
                                        <div>
                                            <label for="month">Month</label><br>
                                            <select id="month" v-model="tempItem.month">
                                                <option v-for="i in MONTH.length" :value="i-1">{{MONTH[i-1]}}</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="day">Day</label><br>
                                            <input id="day" v-model="tempItem.day" type="number" min="1" max="31">
                                        </div>
                                    </div>
                                </p>
                                <p v-if="tempItem.eventType == 'normal'">
                                    <label for="group">List</label><br>
                                    <select id="group" v-model="tempItem.group">
                                        <option value="int">Main Events</option>
                                        <option value="ext">Exterior Events</option>
                                    </select>
                                </p>
                                <p>
                                    <label for="arcId">Arc</label><br>
                                    <select id="arcId" v-model="tempItem.arcId">
                                        <option :value="null">No arc</option>
                                        <option v-for="arc in arcs" :value="arc._id"
                                            :style="{backgroundColor: arc.color, color: '#fff'}">{{arc.name}}</option>
                                    </select>
                                </p>
                                <p>
                                    <label for="pos">Position</label><br>
                                    <input id="pos" v-model="tempItem.pos" type="range" min="6" max="90">
                                </p>

                            </div>

                            <div v-if="tempItem.type == 'arc'">
                                <p>
                                    <label for="color">Color</label><br>
                                    <input type="color" id="color" v-model="tempItem.color" />
                                </p>
                            </div>

                            <p>
                                <label for="note">Notes</label><br>
                                <textarea id="note" v-model="tempItem.note"></textarea>
                            </p>

                            <p>
                                <input type="submit" class="btn btn-primary">
                                <input type="reset" @click="handleCancelForm" class="btn btn-secondary btn-outline"
                                    value="Cancel">
                                <input type="reset" @click="deleteItem(tempItem)" class="btn btn-danger btn-outline"
                                    value="Delete">
                            </p>
                        </form>


                    </div>
                </div>

                <div v-if="isLoading" id="loadingSplash"></div>


            </div>

        </div>

        <div v-show="theaterOn" id="theater" :class="`${theaterMode}`">
            <div id="screen">

                <div id="exitTheater" @click="closeTheater">&times;</div>

                <div id="imageBox" v-if="theaterMode == 'img'" :style="{backgroundImage: `url(${theaterData.img})`}"
                    @click="toggleSubs"></div>

                <div id="recordBox" v-show="theaterMode == 'rec'" :class="{hand: handFont}">
                    <div id="records">

                        <div v-for="rec in records" class="record" :style="{order: rec.order}" :id="`rec_${rec.elId}`">
                            <div class="title" v-html="rec.title"></div>
                            <div class="body" v-html="rec.body"></div>
                        </div>

                    </div>
                </div>

                <div id="toggleFont" v-show="theaterMode == 'rec'" :class="{hand: handFont}"><label
                        for="handFont">Aa</label><input type="checkbox" v-model="handFont" id="handFont"></div>

            </div>
            <div id="subs" v-if="theaterData.hasSubs" :class="{on: subsOn}">
                <div v-if="theaterMode == 'img'">
                    <div class="title">{{theaterData.name}}</div>
                    <div class="date" v-if="!theaterData.img">{{theaterData.dateStr}}</div>
                    <div class="place">{{theaterData.loc}}</div>
                    <p class="notes" v-show="theaterData.note" v-html="theaterData.note"></p>
                </div>
            </div>
        </div>

        <div class="modal-wrapper" :class="{on: showModal}">
            <a @click="closeNote"></a>
            <div class="modal">
                <div class="title-bar">
                    <h2>Project Notes</h2>
                    <a @click="closeNote">&times;</a>
                </div>
                <div class="modal-body">
                    <section v-for="note in notes" :id="`note_${note.elId}`" :style="{order: note.order}">
                        <h3>{{note.title || 'Footnote'}}</h3>
                        <div v-html="note.body"></div>
                    </section>
                    <section id="sources">
                        <h3>References and Further Reading</h3>
                        <ol>
                            <li v-for="src in sources" :id="`note_${src.elId}`" class="source-info">
                                <span v-if="src.who" class="who">{{src.who}}.</span>
                                <span v-if="src.date" class="date">({{src.date}})</span>
                                <span v-if="src.title" class="title"><a :href="src.href">{{src.title}}</a></span>
                                <span v-if="src.pub" class="pub">{{src.pub}}:</span>
                                <span v-if="src.cont" class="cont">{{src.cont}},</span>
                                <span v-if="src.cont_date" class="cont_date">{{src.cont_date}}.</span>
                            </li>
                        </ol>
                    </section>
                </div>
            </div>

        </div>

    </div>

    <script src="notesData.js"></script>
    <script src="recordsData.js"></script>
    <script src="sourcesData.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="gallery.js"></script>
    <script src="index.js"></script>

</body>

</html>